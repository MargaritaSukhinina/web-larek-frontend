# Проектная работа "Веб-ларек"
https://github.com/MargaritaSukhinina/web-larek-frontend.git

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных используемые в проекте

Карточка

```

interface IProduct  {
    id: string;
    name: string;
    category: string;
    description: string;
    image: string;
    price: string | null;
}
```

Массив карточек

```

interface IProductList {
    items: IProduct[];
}

Данные для заказа

```

interface IOrderForm {
    pay: 'Онлайн' | 'При получении';
    address: string;
    email: string;
    tell:  string;
}
```

Тип id карточки

```

type TProductId = Pick<IProduct, 'id'>;
```


Тип способа оплаты

```

type Pay = 'Онлайн' | 'При получении';
```

Интерфейс списка товаров в заказе

```

interface IOrderList {
    total: number;
    items: string[];
}
```

Интерфейс формы выбора оплаты и заполнения адреса

```

interface IAddress {
    payment: Pay;
    address: string;
}
```

Интерфейс формы заполнения данных контакта

```

interface IContacts {
    email: string;
    phone:  string;
}
```

Тип данных для отправки заказа по Api

```

type TOrderData = IAddress & IContacts & IOrderList;
```

Интерфейс объекта товаров в заказе для отправки запроса по Api

```

interface IOrder extends TOrderData {
    readyOrder(): TOrderData;
}
```

Интерфейс сборки данных в заказ

```

interface IOrderBailder {
    addressUser: IAddress;
    contactsUser: IContacts;
    orderList: IOrderList;
    result: TOrderData;
}
```

Интерфейс готового заказа

```

interface IOrderResult {
    total: number;
    id: string;
}
```

Интерфейс валидности заказа

```

interface IFormValid {
    valid: boolean;
}
```

Интерфейс рендера формы заказа заказа

```

interface IForm extends IFormValid {
    render(data?: IFormValid): HTMLElement;
}
```

Данные карточки, используемые для отображения ее на главной странице

```

type TCardMain = Pick<ICard, 'name' | 'category' | 'image' | 'price'>;
```

Данные карточки, используемые для модального окна карточки

```

type TCardModal = Pick<ICard, 'name' | 'category' | 'image' | 'description' | 'price'>;
```

Данные карточки, используемые для отображения списка товаров в корзине

```

type TBasketItem = Pick<ICard, 'name'| 'price'>;
```

Данные, используемые для модального окна формы оплаты

```

type TModalPay = Pick<IOrderForm, 'pay' | 'address'>;
```

Данные, используемые для модального окна формы ввода данных пользователя

```

type TModalContacts = Pick<IOrderForm, 'email' | 'tell'>;
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:
- слой представления, отвечающий за отображение данных на странице;
- слой данных, отвечающий за хранение и изменение данных;
- презентер, отвечающий за связь представления и данных.

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер;
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные в ендпоинт, переданный как параметр привызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на события;
- `emit` - инициализация события;
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

### Слой данных

#### Класс Model
Aбстрактный класс для классов хранения и обработки данных.\
Конструктор класса принимает объект с данными и инстанс брокера событий.\
Методы:
- Класс содержит метод emitChanges сообщающий об изменениях

#### Класс Catalog
Наследуется от абстрактного класса Model.
Отвечает за хранение и логику работы с данными товаров в каталоге.\
Конструктор класса принимает принимает объект с данными и инстант брокера событий.\
В полях класса хранятся следующие данные:
- catalog: IProduct[] - массив обьектов карточек;

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- set items(cards: IProduct[]) - записывает массив в items;
- get items(): IProduct[] - получает массив из свойства items;
- getId(id: string): IProduct | undefined - возвращает товар по id.

#### Класс Order
Класс отвечает за хранение и логику работы с данными заказа.\
В полях класса хранятся следующие данные:
- _payment: 'Онлайн' | 'При получении' - информация о способе оплаты;
- _address: string - информация об адресе доставки;
- _email: string - адрес электронной почты заказчика;
- _phone:  string - телефонный номер заказчика;
- _total: number - общая стоимость всех товаров в заказе;
- _items: string[] - массив ID товаров в виде строк.

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- set payment(value: Pay) - сеттер способа оплаты заказа;
- set address(value: string)  - сеттер для адреса покупателя для доставки;
- set email(value: string) - сеттер адреса электронной почты покупателя;
- set phone(value: string) - сеттер контактного номера телефона покупателя;
- set total(value: number) - сеттер общей стоимости заказа;
- set items(value: string[]) - сеттер списка ID товаров в заказе;
- readyОrder(): TOrderData - возвращает готовый объект заказа для отправки по Api


#### Класс OrderBuilder
Наследуется от абстрактного класса Model.\
Конструктор класса принимает объект с входными данными и брокер событий.\

Методы класса:
- set addressUser(addressUser: IAddress) - сеттер способа оплаты заказа и адреса доставки;
- set contactsUser(contactsUser: IContacts) - сеттер телефона и email покупателя;
- set orderList(orderList: IOrderList) - сеттер данных о товарах в заказе;
- get result(): IOrder -  геттер возвращает объект заказа.

#### Класс BasketState

Наследуется от абстрактного класса Model.
Класс отвечает за хранение и логику работы с данными корзины.\
В полях класса хранятся следующие данные:
- _items: IProduct[]; - список объектов карточек в корзине;

Методы класса:
- get items(): IProduct[] - получает массив товаров;
- get total(): number - получает общую стоимость товаров;
- get lenght(): number - получает длину массива товаров;
- add(item: IProduct): void - добавляет товар в корзину по id;
- remove(id: string): void - удаляет товар из корзины по id;
- check(id: string): boolean - проверяет наличие товара в корзине по id;
- clear(): void - очищает корзину при успешном оформлении заказа;
- getIdItems(): string[] - получает массива строк id товаров.


### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемента) передаваемых в них данных.

#### Класс Component
Базовый абстрактный класс для всех классов - отображений
Методы класса:
- setText(element: HTMLElement, value: unknown) - установка текста в выбранный HTMLElement;
- setHidden(element: HTMLElement) - скрывает переданный html элемент;
- setVisible(element: HTMLElement) - отображает переданный html элемент;
- render(data?: Partial<T>): HTMLElement - возвращает корневой DOM элемент;
- toggleClass(element: HTMLElement, className: string, force?: boolean) - переключение класса;
- setImage(element: HTMLImageElement, src: string, alt?: string) - устанавливает изображение с алтернативным текстом.

#### Класс Modal
Реализует модальное окно.\
Методы `open` и `close` для управления отображением модального окна
Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия модального окна.\
Конструктор класса:
- constructor(container: HTMLElement, events: IEvents) - принимает селектор, по которому в разметке страницы будет найдено модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса
- content: HTMLElement - элемент модального окна;
- events: IEvents - брокер событий;
- _closeButton: HTMLButtonElement - кнопка закрытия модального окна.

#### Класс Basket

Реализует контент модального окна корзины. При открытии модального окна получает данные для списка выбранных товаров.\
Поля класса:
- _list: HTMLElement - элемент содержащий список выбранных товаров;
- _total: HTMLElement - общая стоимость выбранных товаров;
- _button: HTMLElement - кнопка оформления заказа;
- events: IEvents - брокер событий.

Методы:
- set items(items: HTMLElement[]) - отвечает за список выбранных товаров в корзине;
- set total(total: number) - считает суммарную стоимость товаров в корзине;
- set valid(state: boolean) - отвечает за активность кнопки перехода к оплате.

#### Класс Form

Наследуется от абстрактного класса View.\
Конструктор принимает контейнер для идентификации в разметке формы и экземпляр класса EventEmitter для инициализации событий

Поля класса:
- _submit: HTMLButtonElement - кнопка подтверждения;
- container: HTMLFormElement - элемент формы;
- _input: HTMLInputElement[] - список инпутов формы;
- _errors: HTMLElement - элемент для вывода сообщений об ошибках;
- events: IEvents - брокер событий.

Методы:
- setValid(value: boolean): void - изменяет активность кнопки подтверждения;
- get valid(): boolean - получение статуса валидности формы;
- setError(value: string): void - принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода;
- clear(): void - очистка полей формы;
- emitInput(): void - для контроля заполнения полей формы;
- render(data?: Partial<IFormState>): HTMLElement -  рендер формы на странице.

#### Класс FormOrder

Наследуется от класса Form.\
Отвечает за форму заказа (способ оплаты и адресс доставки).\
Конструктор принимает контейнер для идентификации в разметке и экземпляр класса EventEmitter для инициализации событий.\

Поля класса:
- buttonContainer: HTMLElement - элемент с кнопками способа оплаты;
- online: HTMLButtonElement - кнопка оплаты по карте;
- cash: HTMLButtonElement - кнопка оплаты при получении;
- _address: HTMLInputElement - поле ввода адреса доставки.

Методы:
- toggelOnline(state = true): void - переключатель классов-модификаторов кнопоки способа оплаты;
- toggelCash(state = true): void - переключатель классов-модификаторов кнопоки способа оплаты;
- reset(): void - сбрасывает класс-модификатор с кнопок способа оплаты;
- getActive(): HTMLButtonElement | null -  возвращает кнопку способы оплаты;
- clear(): void - очищает форму;
- get payment(): string - возвращает способ оплаты;
- get address(): string - возвращает адресс;
- set valid(value: boolean) - устанавливает валидность формы, блокируя кнопку;
- get valid(): boolean -  возвращает валидность формы.


#### Класс FormContact

Наследуется от класса Form.\
Отвечает за форму контактов для оформления заказа.\
Конструктор принимает контейнер для идентификации в разметке и экземпляр класса EventEmitter для инициализации событий.\

Поля класса:
- _email: HTMLInputElement - инпут формы для ввода email;
- _phone: HTMLInputElement - инпут формы для ввода телефона;

Методы класса:
- get email(): string - возвращает email из инпута;
- get phone(): string - возвращает телефон из инпута.

#### Класс Success

Отвечает за отображение модального окна успешной покупки.\

Поля класса:
- _button: HTMLButtonElement - кнопка возврата к покупкам;
- description: HTMLElement - элемент с общей суммой за заказ;
- events: IEvents - брокер событий.

Методы класса:
- set total(value: number) - устанавливает в DOM общую сумму заказа.

#### Класс Card

Наследуется от абстрактного класса Component.\
Конструктор принимает контейнер для идентификации в разметке и экземпляр класса EventEmitter для инициализации событий.\

Поля класса содержат элементы разметки элементов карточки:
- _title: HTMLElement - наименование карточки;
- _price: HTMLElement - стоимость товара;
- cardId: string - id карточки (товара);
- events: IEvents - брокер событий.

Методы:
- set id(value: string) - сеттер id карточки (товара);
- get id() - геттер возвращает id карточки (товара);
- set title(value: string) - сеттер устанавливает в DOM название товара;
- get title() -  возвращает название товара;
- set price(value: number | null) - устанавливает в DOM стоимость тавара;

#### Класс CardBasket

Наследуется от абстрактного класса Component.\
Отвечает за отображение товара в корзине.\
Конструктор принимает контейнер для идентификации в разметке и экземпляр класса EventEmitter для инициализации событий.\

Поля класса:
- _button: HTMLButtonElement - кнопка удаления товара из корзины;
- _index: HTMLElement элемент нумерации товаров в корзине;

Методы класса:
- set index(value: number) - устанавливает в DOM порядковый номер товара в корзине.

#### Класс CardCatalog

Наследуется от абстрактного класса Component.\
Отвечает за отображение товара на гловной странице.\
Конструктор принимает контейнер для идентификации в разметке и экземпляр класса EventEmitter для инициализации событий.\

Поля класса:
- _category?: HTMLElement - категория товара;
- _image?: HTMLImageElement - изображение на карточке с товаром;

Методы класса:
- set category(value: string) - устанавливает в DOM категорию товара;
- get category(): string - возвращает строку с категорией товара;
- set image(value: string) -  устанавливает в DOM изображение товара;
- toggleCategoryClass(value: string): void - переключатель класса-модификатора категории товара.

#### Класс CardModal

Наследуется от абстрактного класса Component.\
Отвечает за отображение товара в модальном окне.\
Конструктор принимает контейнер для идентификации в разметке и экземпляр класса EventEmitter для инициализации событий.\

Поля класса:
- _description?: HTMLElement - элемент полного описания товара;
- _button: HTMLButtonElement - кнопка добавления в корзину;

Методы класса:
- set description(value: string) - устанавливает в DOM полное описание товара;
- set valid(state: boolean) - устанавливает валидность стоимости товара, блокирует кнопку;
- get valid(): boolean - возвращает true или false в зависимости от наличия цены на товар;
- set state(state: boolean) - блокирует кнопку покупки в зависимости от наличия товара в корзине.

#### Класс Page
Отвечает за отображение главной страницы. Содержит сеттеры для полного наполнения страницы содержимым. В конструктор принимает контейнеры, в которых размещаются шапка сайта с корзиной заказов и каталог с карточками товаров.

Поля класса:
- _counter: HTMLElement - счетчик товаров в корзине;
- _catalog: HTMLElement - каталог товаров на сайте;
- _wrapper: HTMLElement -  элемент разметки для блокировки страницы при открытом модальном окне;
- _basket: HTMLElement - кнопка корзины;
- events: IEvents - брокер событий.

Методы класса:
- set counter(value: number) - сеттер счетчика товаров в корзине;
- set catalog(items: HTMLElement[]) - сеттер для установки каталога карточек товаров на страницу;
- set locked(value: boolean) -  блокировка страницы при открытом модальном окне.

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `items:changed` - изменение массива карточек.

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `card:select` - выбор карточки для отображения в модальном окне;
- `modal:open` - открытие модального окна;
- `modal:close` - закрытие модального окна;
- `cardBasket:delete` - удаление товара из списка товаров в корзине;
- `basket:open` - открытие модального окна корзины;
- `payFill:open` - открытие модального окна заполнения формы оплаты и адреса доставки;
- `olderFill:open` - открытие модального окна с формой редактирования данных пользователя для заказа;
- `order:input` - ввод данных в форме информации о заказе;
- `contacts:input` - ввод данных в форме информации о контактах;
- `'add-card:submit` - добавление товара в корзину в модальном окне карточки;
- `'order:submit` - сохранение данных оплаты в модальном окне;
- `contacts:submit` - сохранение данных о контактах заказа в модальном окне;
- `success:submite` - переход к новым покупкам после успешного заказа.